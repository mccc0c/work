<!DOCTYPE html>
<html>

<head>
	<title>上传文件</title>
</head>

<body>
	<input type="file" name="file" id="fileupload1">
	<script type="text/javascript">
	var isIE = /msie/i.test(navigator.userAgent) && !window.opera;

	function checkFile(target) {
		var fileSize = 0;
		var filepath = target.value;
		// 文件上传类型
		var filetypes, filemaxsize;
		filemaxsize = 1024 * 30; //30M

		if (isIE && !target.files) {
			var filePath = target.value;
			var fileSystem = new ActiveXObject("Scripting.FileSystemObject");
			if (!fileSystem.FileExists(filePath)) {
				$(".filetypeBox p").text("附件不存在，请重新输入！");
				filetypeBox.open();
				return false;
			}
			var file = fileSystem.GetFile(filePath);
			fileSize = file.Size;
		} else {
			fileSize = target.files[0].size;
		}
		var size = fileSize / 1024;
		if (size > filemaxsize) {
			$(".filetypeBox p").text("附件大小不能大于" + filemaxsize / 1024 + "M！");
			filetypeBox.open();
			target.value = "";
			return false;
		}
		if (size <= 0) {

			$(".filetypeBox p").text("附件大小不能为0M！");
			target.value = "";
			return false;
		}
	}

	function ajaxupload(upload_url, fileupload_id) {

		var filetypes = [".pdf", ".PDF"];
		if (fileupload_id == 4 || fileupload_id == 5 || fileupload_id == 6) {
			filetypes = [".html", ".HTML", ".HTM", ".htm"];
		}

		var filepath = $('#fileupload' + fileupload_id).val(),
			fileend = filepath.substring(filepath.lastIndexOf(".")),
			isnext = false;
		if (filetypes && filetypes.length > 0) {
			for (var i = 0; i < filetypes.length; i++) {
				if (filetypes[i] == fileend) {
					isnext = true;
					break;
				}
			}
		}
		if (!isnext) {
			$(".filetypeBox p").text("您上传的附件不符合格式请重新上传！");
			filetypeBox.open();
			return false;
		}
		var target = $('#fileupload' + fileupload_id)[0];
		checkFile(target);

		$.ajaxFileUpload({
			url: upload_url,
			secureuri: false,
			fileElementId: "fileupload" + fileupload_id,
			dataType: 'json',
			data: { 'page_step': 2 },
			type: 'post',
			success: function(data) {
				if (typeof(data.error) != "undefined") {
					//显示图片格式提示弹窗
					$(".filetypeBox p").text(data.error);
					filetypeBox.open();
					return false;
				}
				$("#dq" + fileupload_id).prop('href', "/uploadfile/yirongtong/pdf/yangpu/" + data.pic);
				$("#dq" + fileupload_id).text('当前附件：' + data.pic).next('.msg').hide();
				$("#files" + fileupload_id).val(data.pic);
				$("#upload_tip" + fileupload_id).hide();
			},
			error: function(xhr) {

			}
		});
	}

	$(".editList").delegate("#fileupload1", 'change', function() {
        ajaxupload('/yrtong/yangpu/ajax_upload_files/1', 1);
    });
	</script>
</body>

</html>