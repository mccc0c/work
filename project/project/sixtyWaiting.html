<!DOCTYPE html>
<html>

<head>
	<title>倒计时60秒</title>
	<style>
	.checkReal{width:70px;color:#3e9fff;background:#e5f3ff;border:1px solid #8ac5f8;}
	.clickwaiting{color:#666;background:#eee;border:1px solid #ddd;}
	</style>
</head>

<body>
	<div class="checkReal">check</div>
	<script src="js/jquery.js"></script>
	<script src="js/cookie.js"></script>
	<script>
	$(function() {
		var settime = 20,
			clicktime = "setclicktime",//用户名来命名
			flag = true,
			wait = settime;

		if (getCookie(clicktime)) {
			console.log(getCookie(clicktime));
			var cha = difftime(getCookie(clicktime));
			if (cha < settime) {
				wait = settime - cha;
				console.log(wait);
				time($('.checkReal'));
				flag = false;
			} else {
				flag = true;
			}
		}

		function time(ele) {
			if (wait == 0) {
				flag = true;
				ele.text("check");
				ele.removeClass('clickwaiting');
				wait = settime;
			} else {
				ele.addClass('clickwaiting');
				ele.text("wait(" + wait + ")");
				wait--;
				setTimeout(function() {
						time(ele)
					},
					1000)
			}
		}
		/*计算点击到刷新的时间差*/
		function difftime(clicktime) {
			var diff = Math.floor((new Date().getTime() - clicktime) / 1000);
			return diff;
		}

		$('body').on('click', '.checkReal', function() {
			if (!flag) { return; };
			setCookie(clicktime, new Date().getTime());
			time($(this));
			console.log("checked");
			flag = false;
		});
	});

	/*var pCount = getCookie('pCount');
    var cTimer;
    var cFlag = true;
    if (pCount) {
        var pTime = getCookie('pTime');
        var time2 = (new Date()).getTime();
        var a = pCount - Math.floor((time2 - pTime) / 1000);
        $('.checkReal').text("重新发送(" + a + ")");
        $('.sms').addClass('on');
        counter(a);
        if (a < 0) {
            resetCounter();
            $('.checkReal').removeClass('btnclickon');
            $('.checkReal').closest('li').find('input[name="custName"]').removeClass("noinput");
        };
        var name = getCookie('companyInput');
        get_enterprise_info(name)
    };

    function resetCounter() {
        clearInterval(cTimer);
        $('.sms').removeClass('on');
        cFlag = true;
        $('.checkReal').text("检查名称真实性");
        $('#custName').attr("readonly",false);
        removeCookie('pCount');
        removeCookie('pTime');
    };

    function counter(a) {
        $('#custName').attr("readonly","readonly");
        $('.checkReal').addClass('btnclickon');
        $('.checkReal').closest('li').find('input[name="custName"]').addClass("noinput");
        cTimer = setInterval(function() {
            if (a > 0) {
                a--;
                $('.checkReal').text("重新发送(" + a + ")");
                setCookie('pCount', a);
                setCookie('pTime', (new Date()).getTime());
            } else {
                resetCounter();
                $('.checkReal').removeClass('btnclickon');
                $('.checkReal').closest('li').find('input[name="custName"]').removeClass("noinput");
            }
        }, 1000);
    };
    var rcom = getCookie('companyInput');
    if (rcom) {
        $('#custName').val(rcom);
    };
    // 检查企业名称真实性
    $('body').on('click', '.checkReal', function() {
        if (!cFlag) {
            return;
        };
        $('#register_none_tip').hide();
        $(this).siblings('.msg').css("visibility", "hidden");
        filetypeBox.close();
        var name = $('#custName').val();
        var pattern = /^[\u4E00-\u9FA5\(\)\（\）]+$/;
        if (name == undefined || name == '') {
            $(this).siblings('.msg').text("企业名称不能为空").css("visibility", "visible");
            cFlag = true;
        } else if (!pattern.test(name)) {
            $(this).siblings('.msg').text("企业名称不规范").css("visibility", "visible");
            cFlag = true;
        }  else {
            var a = getCookie('pCount') || 60;
            counter(a);
            if (get_enterprise_info(name)) {
                setCookie('companyInput', name);
                $(this).siblings('.msg').css("visibility", "hidden");
            }
            cFlag = false;
        };
        
    });*/
	</script>
</body>

</html>